import { Canvas, Meta, Markdown } from "@storybook/blocks";

import * as UseRefStories from "./useRef.stories";

<Meta of={UseRefStories} />

# [useRef ](https://zh-hans.react.dev/reference/react/useRef#)

`useRef` èƒ½å¼•ç”¨ä¸€ä¸ª **ä¸éœ€è¦æ¸²æŸ“** çš„å€¼ï¼Œä¿®æ”¹ `ref.current` å¹¶ä¸ä¼šå¼•èµ·ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼š

```js
const ref = useRef(initialValue);
```

- ä¸»è¦ç”¨æ³•ï¼šä½¿ç”¨ ref å¼•ç”¨ä¸€ä¸ªå€¼ã€é€šè¿‡ ref æ“ä½œ DOMã€é¿å…é‡å¤åˆ›å»º ref çš„å†…å®¹

- å‚æ•°ï¼š

  - `initialValue`ï¼š`ref` å¯¹è±¡çš„ `current` å±æ€§çš„åˆå§‹å€¼ï¼Œ`any` ç±»å‹ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥ï¼Œå³åœ¨åç»­çš„æ¸²æŸ“ä¸­ï¼Œ`useRef` å°†è¿”å›ç›¸åŒçš„å¯¹è±¡

- è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªåªæœ‰ `current` å±æ€§çš„å¯¹è±¡

- æ³¨æ„ï¼š

  - ä¸€ä¸ªä¸ç”¨äºæ¸²æŸ“çš„æ•°æ®ä½¿ç”¨ `ref`ï¼ˆå­˜è®¡æ—¶å™¨ IDï¼‰ï¼Œç”¨äºæ¸²æŸ“çš„è¯åˆ™ä½¿ç”¨ `state`
  - æ”¹å˜ `ref.current` å±æ€§æ—¶ï¼ŒReact ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼ˆ**setState** ä¼šï¼‰ï¼Œref åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ js å¯¹è±¡
  - å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ **å­˜å‚¨ä¿¡æ¯**ï¼ˆæ™®é€šå¯¹è±¡å­˜å‚¨çš„å€¼åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡ç½®ï¼‰
  - é™¤äº†åˆå§‹åŒ–å¤–ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– `ref.current`ï¼Œå¦åˆ™ä¼šä½¿ç»„ä»¶è¡Œä¸ºå˜å¾—ä¸å¯é¢„æµ‹ï¼›å¯ä»¥åœ¨äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€… **Effect** ä¸­è¯»å†™ refï¼›å¦‚æœä¸å¾—ä¸åœ¨æ¸²æŸ“æœŸé—´è¯»å†™ï¼Œåº”ä½¿ç”¨ **State**

```jsx
function MyComponent() {
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ ref
  myRef.current = 123;
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å– ref
  return <h1>{myOtherRef.current}</h1>;
}

function MyComponent() {
  // ...
  useEffect(() => {
    // âœ… å¯ä»¥åœ¨ Effect ä¸­è¯»å–å’Œå†™å…¥ ref
    myRef.current = 123;
  });
  // ...
  function handleClick() {
    // âœ… å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¯»å–å’Œå†™å…¥ ref
    doSomething(myOtherRef.current);
  }
  // ...
}
```

## å¼•ç”¨ä¸€ä¸ªä¸ç”¨äºæ¸²æŸ“çš„å€¼

<Canvas
  of={UseRefStories.Example}
  withToolbar={true}
  sourceState="none"
  additionalActions={[
    {
      title: "Open in GitHub",
      onClick: () => {
        window.open(
          "https://github.com/storybookjs/storybook/blob/next/code/ui/blocks/src/examples/Button.stories.tsx",
          "_blank"
        );
      },
    },
  ]}
/>

```jsx
// ç§’è¡¨
const timer = useRef(null); // å¼•ç”¨è®¡æ—¶å™¨ id
const [start, setStart] = useState(null);
const [now, setNow] = useState(null);

function handleStart() {
  setNow(Date.now());
  setStart(Date.now());

  clearInterval(timer.current);
  timer.current = setInterval(() => {
    setNow(Date.now());
  }, 10);
}

function handleStop() {
  clearInterval(timer.current);
}

let secondsPassed = 0;
if (start && now) {
  secondsPassed = (now - start) / 1000;
}

return (
  <>
    <h1>Time passed: {secondsPassed.toFixed(3)}</h1>
    <button onClick={handleStart}>start</button>
    <button onClick={handleStop}>stop</button>
  </>
);
```

## [é€šè¿‡ ref æ“ä½œ DOM](https://zh-hans.react.dev/reference/react/useRef#manipulating-the-dom-with-a-ref)

- ç»„ä»¶å†…å¯ä»¥é€šè¿‡ ref ç›´æ¥æ“ä½œ
- ä¹Ÿå¯ä»¥é€šè¿‡ `forwardRef` å°†å­ç»„ä»¶å†…çš„ ref è½¬å‘è‡³çˆ¶ç»„ä»¶

```jsx
// èšç„¦è¾“å…¥æ¡†
import { useRef } from "react";

export default function Form() {
  const inputRef = useRef(null);

  function handleClick() {
    inputRef.current.focus();
  }

  return (
    <>
      <input ref={inputRef} />
      <button onClick={handleClick}>èšç„¦è¾“å…¥æ¡†</button>
    </>
  );
}
```

## ref + forwardRef æš´éœ²åˆ°çˆ¶ç»„ä»¶

```jsx
import { forwardRef, useRef } from "react";

const MyInput = forwardRef((props, ref) => {
  return <input {...props} ref={ref} />;
});

export default function Form() {
  const inputRef = useRef(null);

  function handleClick() {
    inputRef.current.focus();
  }

  return (
    <>
      <MyInput ref={inputRef} />
      <button onClick={handleClick}>èšç„¦è¾“å…¥æ¡†</button>
    </>
  );
}
```

## [é¿å…é‡å¤åˆ›å»º ref](https://zh-hans.react.dev/reference/react/useRef#avoiding-recreating-the-ref-contents)

é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å†™å…¥æˆ–è¯»å– `ref.current` æ˜¯ä¸å…è®¸çš„ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºç»“æœæ€»æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”åªåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥æ˜¯å®Œå…¨å¯é¢„æµ‹çš„

```jsx
// åˆå§‹åŒ– Vedio ç»„ä»¶
function Video() {
  const playerRef = useRef(null);
  if (playerRef.current === null) {
    playerRef.current = new VideoPlayer();
}
```
